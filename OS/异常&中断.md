### 一、中断
#### 1.1 中断概念
中断（interrupt）指在程序执行过程中遇到急需处理的事件时，暂时中止现行程序在 CPU 上的运行，转而执行响应的事件处理程序，待处理完成后再返回断点或调度其他程序。
+ 硬件中断导致处理器通过一个上下文切换（context switch）来保存执行状态（以程序计数器和程序状态字等寄存器信息为主）。
+ 软件中断则通常作为CPU指令集中的一个指令，以可编程的方式直接指示这种上下文切换，并将处理导向一段中断处理代码。

#### 1.2 中断分类
1. 按照中断源进行分类：发出中断请求的设备称为中断源。按照中断源的不同，中断可以分为：
    + 内中断：即程序运行错误引起的中断；
    + 外中断：即由外部设备、接口卡引起的中断；
    + 软件中断：由写在程序中的语句引起的中段程序的执行，称为软件中断。

2. 允许/禁止（开/关）中断： CPU通过指令限制某些设备发出中断请求，称为屏蔽中断。从CPU要不要接收中断即能不能限制某些中断发生的角度 ，中断可分为
    + 可屏蔽中断：可被CPU通过指令限制某些设备发出中断请求的中断；
    + 不可屏蔽中断：不允许屏蔽的中断，如电源掉电

#### 1.3 中断处理过程
1. 关中断：CPU关闭中断，即不再接受其他**外部**中断请求。
2. 保存断点：将发生中断处的指令地址压入堆栈，以使中断处理后能正确的返回（注意，有可能保存中断处的指令地址，也有可能是中断处的指令的下一条指令的地址，具体情况视中断的类型）。
3. 识别中断源：CPU识别中断的来源，确定中断类型号，从而找到相应的中断处理程序的入口地址。

*注：以上三步一般由处理中断的硬件电路完成*

4. 保存现场：将发生中断处的有关寄存器（中断服务程序要使用的寄存器）以及标志寄存器的内容压入堆栈。
5. 执行中断服务程序：转到中断服务程序入口开始执行，可在适当时刻重新开放中断，以便允许响应较高优先级的外部中断。
6. 恢复现场并返回：把“保护现场”时压入堆栈的信息弹回寄存器，然后执行中断返回指令，从而返回主程序继续运行。

*注：后三步一般由软件，即中断处理程序完成*

### 二、异常
#### 2.1 异常概念
**内中断，又称异常，同步中断**，是指来自处理器内部的中断信号，通常是由于在程序执行过程中，发现与当前指令关联的、不正常的或错误的事件。内中断不能被屏蔽，一旦出现必须立即予以响应并进行处理，只是处理程序运行过程中可以选择是否屏蔽其它中断或屏蔽哪些中断。 内中断可细分为：
+ 访管中断，由系统程序执行访管指令引起，可以看做机器指令的一种扩充；
+ 硬件故障中断，如：电源失效、奇偶校验错误，总线超时；
+ 程序性中断，如：非法操作、地址越界、页面故障、调试指令、除数为0和浮点溢出等。

#### 2.2 异常和中断的区别与联系

**相同点：**

+ 最后都是由CPU发送给内核，由内核去处理
+ 处理程序的设计上是相似的

**不同点：**

+ 产生源不同：异常是由CPU产生的，而中断是由硬件设备产生的
+ 内核需要根据是异常还是中断调用不同的处理程序
+ 中断不是时钟同步的，这意味着中断可能随时到来；异常由于是由CPU产生的，所以它是时钟同步的
+ 当处理中断时，处于中断上下文中；处理异常时，处于进程上下文中