### 一、什么是ICMP协议
ICMP（Internet Control Message Protocol）中文全称为Internet控制报文协议。它是互联网协议族的核心协议之一。它用于TCP/IP网络中发送控制消息，提供可能发生在通信环境中的各种问题反馈，通过这些信息，使管理者可以对所发生的问题作出诊断，然后采取适当的措施解决。

在IP 网络上，由于数据包被丢弃等原因，为了控制将必要的信息传递给发信方。ICMP 协议是为了辅助IP 协议，交换各种各样的控制信息而被制造出来的。

**ICMP协议是一个网络层协议。**

ICMP的主要功能：
1. 确认IP包是否成功送达目标地址。
2. 通知在发送过程当中IP包被废弃的具体原因。

### 二、ICMP之ping命令
ping 命令用来在IP层次上调查与指定机器是否连通，调查数据包往复需要多少时间。为了实现这个功能，ping 命令使用了两个ICMP 报文。

ping命令的工作过程如下所示：
1. 假设有两个主机，主机A（192.168.0.1）和主机B（192.168.0.2），现在我们要监测主机A和主机B之间网络是否畅通，那么我们在主机A上输入命令：ping 192.168.0.2
2. 此时，ping命令会在主机A上构建一个ICMP请求数据包，然后ICMP协议会将这个数据包以及目标IP（192.168.0.2）等信息一同交给IP层协议
3. IP层协议得到这些信息之后，将源地址（本机IP）、目标地址（目标IP）、再加上一些其他的控制信息，构建成一个IP数据包
4. IP数据包构建完成后，还不够，还需要加上MAC地址，因此还需要通过ARP映射表找出目标IP所对应的MAC地址。当拿到目标主机的MAC地址和本机的MAC地址后，一并交给数据链路层，组装成一个数据帧，依据以太网的介质访问法则，将它们传送出去
5. 当主机B收到这个数据帧后，会首先检查它的目标MAC地址是不是本机，如果是就接收下来处理，接收之后会检查这个数据帧，将数据帧中的IP数据包取出来，交给本机的IP层协议，然后IP层协议检查完之后，再将ICMP数据包取出来交给ICMP协议处理，当这一步也处理完成之后，就会构建一个ICMP应答数据包，回发给主机A；
6. 在一定时间内，如果主机A收到了应答包，则说明它和主机B之间网络可达，如果没收到，则说明网络不可达。除了可达之外，还可以利用应答时间和发起时间之间的差值，计算出数据包的延迟耗时
